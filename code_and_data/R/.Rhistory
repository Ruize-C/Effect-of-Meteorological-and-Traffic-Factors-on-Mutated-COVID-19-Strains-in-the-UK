nsdf(virus$nationalarrival, df=2)
library(dlnm)
#exposure function
varfun = "ns"
vardf= 6
argvar <- list(fun=varfun, df=vardf)
#lag function
lag <- 10
lagfun="ns"
lagdf=3
# crossbasis
cb.Temperature <- crossbasis(virus$Temperature, lag=lag, argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0alp), 2])
cb.Humidity <- crossbasis(virus$Humidity, lag=lag, argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0alp), 3])
cb.WindSpeed <- crossbasis(virus$WindSpeed, lag=lag,argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0alp), 4])
#cb.Pressure <- crossbasis(virus$Pressure, lag=lag,argvar=argvar,
#                          arglag=list(fun=lagfun, df=lagdf),
#                          cen=virus[which.min(virus$R0alp), 5])
cb.UV <- crossbasis(virus$UV, lag=lag,argvar=list(fun="ns", df=2),
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0alp), 13])
lag2 <- 13
cb.tarrival <- crossbasis(virus$totalarrival, lag=lag2, argvar=list(fun="ns", df=2),
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0alp), 11])
cb.narrival <- crossbasis(virus$nationalarrival, lag=lag2, argvar=list(fun="ns", df=2),
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0alp), 12])
library(splines)
library(mgcv)
virus_model <- gam(R0alp ~ te(as.numeric(as.Date(Date)), latitude, longitude, bs=c("cr","tp"), d=c(1,2), k=c(5, 5))
+ cb.Temperature + cb.Humidity + cb.WindSpeed + cb.UV
+ cb.tarrival + cb.narrival
+ s(Pressure)
+ doctors + nonwhite + popdensity,
data=virus,
family=gaussian(link="log"))
summary(virus_model)
##计算贡献度
library(FluMoDL)
attrback_temp <- attrdl(virus$Temperature, cb.Temperature, virus$R0alp,
virus_model,tot=FALSE, type="af",
cen=virus[which.min(virus$R0alp), 2])
attrback_humi <- attrdl(virus$Temperature, cb.Humidity, virus$R0alp,
virus_model, tot=FALSE, type="af",
cen=virus[which.min(virus$R0alp), 3])
attrback_wind <- attrdl(virus$WindSpeed, cb.WindSpeed, virus$R0alp,
virus_model, tot=FALSE, type="af",
cen=virus[which.min(virus$R0alp), 4])
#attrback_pres <- attrdl(virus$Pressure, cb.Pressure, virus$R0alp,
#                        virus_model, tot=FALSE, type="af",
#                        cen=virus[which.min(virus$R0alp), 5])
attrback_UV <- attrdl(virus$UV, cb.UV, virus$R0alp,
virus_model, tot=FALSE, type="af",
cen=virus[which.min(virus$R0alp), 13])
attrback_tarrival <- attrdl(virus$totalarrival, cb.tarrival, virus$R0alp,
virus_model, tot=FALSE, type="af",
cen=virus[which.min(virus$R0alp), 11])
attrback_narrival <- attrdl(virus$nationalarrival, cb.narrival, virus$R0alp,
virus_model, tot=FALSE, type="af",
cen=virus[which.min(virus$R0alp), 12])
result <- cbind(virus,
attrback_temp, attrback_humi, attrback_wind, attrback_UV,
attrback_tarrival, attrback_narrival)
apply(result[ ,c(19:24)], 2, mean, na.rm=TRUE)
city <- read.csv("Adur.csv", header=TRUE, fileEncoding="cp936")
colnames(city) <- c("Date","Temperature","Humidity","WindSpeed","Pressure",
"R0orig","R0orig","R0dlt","R0omi",
"dosePCA","totalarrival","nationalarrival","UV",
"male","female","doctors","nonwhite","popdensity")
longitude <- rnorm(842, -0.285896429, sd=0.003^2)
latitude <- rnorm(842, 50.83854429, sd=0.003^2)
library(tidyverse)
city_model <-
city %>%
select(c(-14, -15)) %>%
mutate(longitude, latitude)
city_model <- city_model[-which(is.na(city_model$totalarrival | city_model$nationalarrival | city_model$UV)),]
#####run the model
###dlt
virus <-
city_model %>%
slice(446:727) %>%
filter(R0dlt>0 & R0dlt<10)
#####run the model
###dlt
library(dlnm)
#exposure function
varfun = "ns"
vardf=3
argvar <- list(fun=varfun, df=vardf)
#lag function
lag <- 16
lagfun="ns"
lagdf=3
# crossbasis
cb.Temperature <- crossbasis(virus$Temperature, lag=lag, argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 2])
cb.Humidity <- crossbasis(virus$Humidity, lag=lag, argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 3])
cb.WindSpeed <- crossbasis(virus$WindSpeed, lag=lag,argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 4])
#cb.Pressure <- crossbasis(virus$Pressure, lag=lag,argvar=argvar,
#                          arglag=list(fun=lagfun, df=lagdf),
#                          cen=virus[which.min(virus$R0dlt), 5])
cb.UV <- crossbasis(virus$UV, lag=lag,argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 13])
lag2 <- 7
cb.tarrival <- crossbasis(virus$totalarrival, lag=lag2, argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 11])
cb.narrival <- crossbasis(virus$nationalarrival, lag=lag2, argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 12])
library(splines)
library(mgcv)
virus_model <- gam(R0dlt ~ te(as.numeric(as.Date(Date)), latitude, longitude, bs=c("cr","tp"), d=c(1,2), k=c(5, 5))
+ cb.Temperature + cb.Humidity + cb.WindSpeed + cb.UV
+ cb.tarrival + cb.narrival
+ s(Pressure)
+ doctors + nonwhite + popdensity,
data=virus,
family=gaussian(link="log"))
summary(virus_model)
##计算贡献度
library(FluMoDL)
attrback_temp <- attrdl(virus$Temperature, cb.Temperature, virus$R0dlt,
virus_model,tot=FALSE, type="af",
cen=virus[which.min(virus$R0dlt), 2])
attrback_humi <- attrdl(virus$Temperature, cb.Humidity, virus$R0dlt,
virus_model, tot=FALSE, type="af",
cen=virus[which.min(virus$R0dlt), 3])
attrback_wind <- attrdl(virus$WindSpeed, cb.WindSpeed, virus$R0dlt,
virus_model, tot=FALSE, type="af",
cen=virus[which.min(virus$R0dlt), 4])
#attrback_pres <- attrdl(virus$Pressure, cb.Pressure, virus$R0dlt,
#                        virus_model, tot=FALSE, type="af",
#                        cen=virus[which.min(virus$R0dlt), 5])
attrback_UV <- attrdl(virus$UV, cb.UV, virus$R0dlt,
virus_model, tot=FALSE, type="af",
cen=virus[which.min(virus$R0dlt), 13])
attrback_tarrival <- attrdl(virus$totalarrival, cb.tarrival, virus$R0dlt,
virus_model, tot=FALSE, type="af",
cen=virus[which.min(virus$R0dlt), 11])
attrback_narrival <- attrdl(virus$nationalarrival, cb.narrival, virus$R0dlt,
virus_model, tot=FALSE, type="af",
cen=virus[which.min(virus$R0dlt), 12])
result <- cbind(virus,
attrback_temp, attrback_humi, attrback_wind, attrback_UV,
attrback_tarrival, attrback_narrival)
apply(result[ ,c(19:24)], 2, mean, na.rm=TRUE)
city <- read.csv("Adur.csv", header=TRUE, fileEncoding="cp936")
colnames(city) <- c("Date","Temperature","Humidity","WindSpeed","Pressure",
"R0orig","R0orig","R0dlt","R0omi",
"dosePCA","totalarrival","nationalarrival","UV",
"male","female","doctors","nonwhite","popdensity")
longitude <- rnorm(842, -0.285896429, sd=0.003^2)
latitude <- rnorm(842, 50.83854429, sd=0.003^2)
library(tidyverse)
city_model <-
city %>%
select(c(-14, -15)) %>%
mutate(longitude, latitude)
city_model <- city_model[-which(is.na(city_model$totalarrival | city_model$nationalarrival | city_model$UV)),]
colnames(city) <- c("Date","Temperature","Humidity","WindSpeed","Pressure",
"R0orig","R0orig","R0dlt","R0omi",
"dosePCA","totalarrival","nationalarrival","UV",
"male","female","doctors","nonwhite","popdensity")
longitude <- rnorm(842, -0.285896429, sd=0.003^2)
latitude <- rnorm(842, 50.83854429, sd=0.003^2)
library(tidyverse)
city_model <-
city %>%
select(c(-14, -15)) %>%
mutate(longitude, latitude)
city <- read.csv("Adur.csv", header=TRUE, fileEncoding="cp936")
colnames(city) <- c("Date","Temperature","Humidity","WindSpeed","Pressure",
"R0orig","R0alp","R0dlt","R0omi",
"dosePCA","totalarrival","nationalarrival","UV",
"male","female","doctors","nonwhite","popdensity")
longitude <- rnorm(842, -0.285896429, sd=0.003^2)
latitude <- rnorm(842, 50.83854429, sd=0.003^2)
library(tidyverse)
city_model <-
city %>%
select(c(-14, -15)) %>%
mutate(longitude, latitude)
city_model <- city_model[-which(is.na(city_model$totalarrival | city_model$nationalarrival | city_model$UV)),]
#####run the model
###dlt
virus <-
city_model %>%
slice(446:727) %>%
filter(R0dlt>0 & R0dlt<10)
library(dlnm)
#exposure function
varfun = "ns"
vardf=3
argvar <- list(fun=varfun, df=vardf)
#lag function
lag <- 16
lagfun="ns"
lagdf=3
# crossbasis
cb.Temperature <- crossbasis(virus$Temperature, lag=lag, argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 2])
cb.Humidity <- crossbasis(virus$Humidity, lag=lag, argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 3])
cb.WindSpeed <- crossbasis(virus$WindSpeed, lag=lag,argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 4])
#cb.Pressure <- crossbasis(virus$Pressure, lag=lag,argvar=argvar,
#                          arglag=list(fun=lagfun, df=lagdf),
#                          cen=virus[which.min(virus$R0dlt), 5])
cb.UV <- crossbasis(virus$UV, lag=lag,argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 13])
lag2 <- 7
cb.tarrival <- crossbasis(virus$totalarrival, lag=lag2, argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 11])
cb.narrival <- crossbasis(virus$nationalarrival, lag=lag2, argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 12])
library(splines)
library(mgcv)
virus_model <- gam(R0dlt ~ te(as.numeric(as.Date(Date)), latitude, longitude, bs=c("cr","tp"), d=c(1,2), k=c(5, 5))
+ cb.Temperature + cb.Humidity + cb.WindSpeed + cb.UV
+ cb.tarrival + cb.narrival
+ s(Pressure)
+ doctors + nonwhite + popdensity,
data=virus,
family=gaussian(link="log"))
summary(virus_model)
##计算贡献度
library(FluMoDL)
attrback_temp <- attrdl(virus$Temperature, cb.Temperature, virus$R0dlt,
virus_model,tot=FALSE, type="af",
cen=virus[which.min(virus$R0dlt), 2])
attrback_humi <- attrdl(virus$Temperature, cb.Humidity, virus$R0dlt,
virus_model, tot=FALSE, type="af",
cen=virus[which.min(virus$R0dlt), 3])
attrback_wind <- attrdl(virus$WindSpeed, cb.WindSpeed, virus$R0dlt,
virus_model, tot=FALSE, type="af",
cen=virus[which.min(virus$R0dlt), 4])
#attrback_pres <- attrdl(virus$Pressure, cb.Pressure, virus$R0dlt,
#                        virus_model, tot=FALSE, type="af",
#                        cen=virus[which.min(virus$R0dlt), 5])
attrback_UV <- attrdl(virus$UV, cb.UV, virus$R0dlt,
virus_model, tot=FALSE, type="af",
cen=virus[which.min(virus$R0dlt), 13])
attrback_tarrival <- attrdl(virus$totalarrival, cb.tarrival, virus$R0dlt,
virus_model, tot=FALSE, type="af",
cen=virus[which.min(virus$R0dlt), 11])
attrback_narrival <- attrdl(virus$nationalarrival, cb.narrival, virus$R0dlt,
virus_model, tot=FALSE, type="af",
cen=virus[which.min(virus$R0dlt), 12])
result <- cbind(virus,
attrback_temp, attrback_humi, attrback_wind, attrback_UV,
attrback_tarrival, attrback_narrival)
apply(result[ ,c(19:24)], 2, mean, na.rm=TRUE)
View(virus)
cb.dose <- crossbasis(virus$dosePCA, lag=lag2, argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 10])
virus_model <- gam(R0dlt ~ te(as.numeric(as.Date(Date)), latitude, longitude, bs=c("cr","tp"), d=c(1,2), k=c(5, 5))
+ cb.Temperature + cb.Humidity + cb.WindSpeed + cb.UV
+ cb.tarrival + cb.narrival + cb.dose
+ s(Pressure)
+ doctors + nonwhite + popdensity,
data=virus,
family=gaussian(link="log"))
summary(virus_model)
virus <-
city_model %>%
slice(446:727) %>%
filter(R0dlt>0 & R0dlt<10)
#####run the model
###dlt
library(dlnm)
#exposure function
varfun = "ns"
vardf=3
argvar <- list(fun=varfun, df=vardf)
#lag function
lag <- 16
lagfun="ns"
lagdf=3
# crossbasis
cb.Temperature <- crossbasis(virus$Temperature, lag=lag, argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 2])
cb.Humidity <- crossbasis(virus$Humidity, lag=lag, argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 3])
cb.WindSpeed <- crossbasis(virus$WindSpeed, lag=lag,argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 4])
#cb.Pressure <- crossbasis(virus$Pressure, lag=lag,argvar=argvar,
#                          arglag=list(fun=lagfun, df=lagdf),
#                          cen=virus[which.min(virus$R0dlt), 5])
cb.UV <- crossbasis(virus$UV, lag=lag,argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 13])
lag2 <- 7
cb.tarrival <- crossbasis(virus$totalarrival, lag=lag2, argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 11])
cb.narrival <- crossbasis(virus$nationalarrival, lag=lag2, argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 12])
cb.dose <- crossbasis(virus$dosePCA, lag=lag2, argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 10])
library(splines)
library(mgcv)
virus_model <- gam(R0dlt ~ te(as.numeric(as.Date(Date)), latitude, longitude, bs=c("cr","tp"), d=c(1,2), k=c(5, 5))
+ cb.Temperature + cb.Humidity + cb.WindSpeed + cb.UV
+ cb.tarrival + cb.narrival + cb.dose
+ s(Pressure)
+ doctors + nonwhite + popdensity,
data=virus,
family=gaussian(link="log"))
summary(virus_model)
##计算贡献度
library(FluMoDL)
attrback_temp <- attrdl(virus$Temperature, cb.Temperature, virus$R0dlt,
virus_model,tot=FALSE, type="af",
cen=virus[which.min(virus$R0dlt), 2])
attrback_humi <- attrdl(virus$Temperature, cb.Humidity, virus$R0dlt,
virus_model, tot=FALSE, type="af",
cen=virus[which.min(virus$R0dlt), 3])
attrback_wind <- attrdl(virus$WindSpeed, cb.WindSpeed, virus$R0dlt,
virus_model, tot=FALSE, type="af",
cen=virus[which.min(virus$R0dlt), 4])
#attrback_pres <- attrdl(virus$Pressure, cb.Pressure, virus$R0dlt,
#                        virus_model, tot=FALSE, type="af",
#                        cen=virus[which.min(virus$R0dlt), 5])
attrback_UV <- attrdl(virus$UV, cb.UV, virus$R0dlt,
virus_model, tot=FALSE, type="af",
cen=virus[which.min(virus$R0dlt), 13])
attrback_tarrival <- attrdl(virus$totalarrival, cb.tarrival, virus$R0dlt,
virus_model, tot=FALSE, type="af",
cen=virus[which.min(virus$R0dlt), 11])
attrback_narrival <- attrdl(virus$nationalarrival, cb.narrival, virus$R0dlt,
virus_model, tot=FALSE, type="af",
cen=virus[which.min(virus$R0dlt), 12])
attrback_dose <- attrdl(virus$dosePCA, cb.narrival, virus$R0dlt,
virus_model, tot=FALSE, type="af",
cen=virus[which.min(virus$R0dlt), 12])
result <- cbind(virus,
attrback_temp, attrback_humi, attrback_wind, attrback_UV,
attrback_tarrival, attrback_narrival, attrback_dose)
apply(result[ ,c(19:25)], 2, mean, na.rm=TRUE)
### aic for environment
aic <- c(rep(0, 30))
for(i in 1:30){
varfun = "ns"
vardf=3
argvar <- list(fun=varfun, df=vardf)
lag <- i
lagfun="ns"
lagdf=3
cb.Temperature <- crossbasis(virus$Temperature, lag=lag, argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 2])
cb.Humidity <- crossbasis(virus$Humidity, lag=lag, argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 3])
cb.WindSpeed <- crossbasis(virus$WindSpeed, lag=lag,argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 4])
cb.UV <- crossbasis(virus$UV, lag=lag,argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 13])
virus_model <- gam(R0dlt ~ te(as.numeric(as.Date(Date)), latitude, longitude, bs=c("cr","tp"), d=c(1,2), k=c(5, 5))
+ cb.Temperature + cb.Humidity + cb.WindSpeed + cb.UV
+ cb.tarrival + cb.narrival + cb.dose
+ s(Pressure)
+ doctors + nonwhite + popdensity,
data=virus,
family=gaussian(link="log"))
aic[i] <- AIC(virus_model)
}
as.data.frame(aic)
lag <- 15
lagfun="ns"
lagdf=3
# crossbasis
cb.Temperature <- crossbasis(virus$Temperature, lag=lag, argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 2])
cb.Humidity <- crossbasis(virus$Humidity, lag=lag, argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 3])
cb.WindSpeed <- crossbasis(virus$WindSpeed, lag=lag,argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 4])
#cb.Pressure <- crossbasis(virus$Pressure, lag=lag,argvar=argvar,
#                          arglag=list(fun=lagfun, df=lagdf),
#                          cen=virus[which.min(virus$R0dlt), 5])
cb.UV <- crossbasis(virus$UV, lag=lag,argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 13])
aic2 <- c(rep(0, 30))
for(j in 1:30){
lag2 <- j
cb.tarrival <- crossbasis(virus$totalarrival, lag=lag2, argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 11])
cb.narrival <- crossbasis(virus$nationalarrival, lag=lag2, argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 12])
cb.dose <- crossbasis(virus$dosePCA, lag=lag2, argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 10])
virus_model <- gam(R0dlt ~ te(as.numeric(as.Date(Date)), latitude, longitude, bs=c("cr","tp"), d=c(1,2), k=c(5, 5))
+ cb.Temperature + cb.Humidity + cb.WindSpeed + cb.UV
+ cb.tarrival + cb.narrival + cb.dose
+ s(Pressure)
+ doctors + nonwhite + popdensity,
data=virus,
family=gaussian(link="log"))
aic2[j] <- AIC(virus_model)
}
as.data.frame((aic2))
library(dlnm)
#exposure function
varfun = "ns"
vardf=3
argvar <- list(fun=varfun, df=vardf)
#lag function
lag <- 15
lagfun="ns"
lagdf=3
# crossbasis
cb.Temperature <- crossbasis(virus$Temperature, lag=lag, argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 2])
cb.Humidity <- crossbasis(virus$Humidity, lag=lag, argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 3])
cb.WindSpeed <- crossbasis(virus$WindSpeed, lag=lag,argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 4])
#cb.Pressure <- crossbasis(virus$Pressure, lag=lag,argvar=argvar,
#                          arglag=list(fun=lagfun, df=lagdf),
#                          cen=virus[which.min(virus$R0dlt), 5])
cb.UV <- crossbasis(virus$UV, lag=lag,argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 13])
lag2 <- 11
cb.tarrival <- crossbasis(virus$totalarrival, lag=lag2, argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 11])
cb.narrival <- crossbasis(virus$nationalarrival, lag=lag2, argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 12])
cb.dose <- crossbasis(virus$dosePCA, lag=lag2, argvar=argvar,
arglag=list(fun=lagfun, df=lagdf),
cen=virus[which.min(virus$R0dlt), 10])
library(splines)
library(mgcv)
virus_model <- gam(R0dlt ~ te(as.numeric(as.Date(Date)), latitude, longitude, bs=c("cr","tp"), d=c(1,2), k=c(5, 5))
+ cb.Temperature + cb.Humidity + cb.WindSpeed + cb.UV
+ cb.tarrival + cb.narrival + cb.dose
+ s(Pressure)
+ doctors + nonwhite + popdensity,
data=virus,
family=gaussian(link="log"))
summary(virus_model)
##计算贡献度
library(FluMoDL)
attrback_temp <- attrdl(virus$Temperature, cb.Temperature, virus$R0dlt,
virus_model,tot=FALSE, type="af",
cen=virus[which.min(virus$R0dlt), 2])
attrback_humi <- attrdl(virus$Temperature, cb.Humidity, virus$R0dlt,
virus_model, tot=FALSE, type="af",
cen=virus[which.min(virus$R0dlt), 3])
attrback_wind <- attrdl(virus$WindSpeed, cb.WindSpeed, virus$R0dlt,
virus_model, tot=FALSE, type="af",
cen=virus[which.min(virus$R0dlt), 4])
#attrback_pres <- attrdl(virus$Pressure, cb.Pressure, virus$R0dlt,
#                        virus_model, tot=FALSE, type="af",
#                        cen=virus[which.min(virus$R0dlt), 5])
attrback_UV <- attrdl(virus$UV, cb.UV, virus$R0dlt,
virus_model, tot=FALSE, type="af",
cen=virus[which.min(virus$R0dlt), 13])
attrback_tarrival <- attrdl(virus$totalarrival, cb.tarrival, virus$R0dlt,
virus_model, tot=FALSE, type="af",
cen=virus[which.min(virus$R0dlt), 11])
attrback_narrival <- attrdl(virus$nationalarrival, cb.narrival, virus$R0dlt,
virus_model, tot=FALSE, type="af",
cen=virus[which.min(virus$R0dlt), 12])
attrback_dose <- attrdl(virus$dosePCA, cb.narrival, virus$R0dlt,
virus_model, tot=FALSE, type="af",
cen=virus[which.min(virus$R0dlt), 12])
result <- cbind(virus,
attrback_temp, attrback_humi, attrback_wind, attrback_UV,
attrback_tarrival, attrback_narrival, attrback_dose)
apply(result[ ,c(19:25)], 2, mean, na.rm=TRUE)
